<!DOCTYPE html>
<html>
<head>
  <title><%= @post.title %></title>
</head>
<body>
<%= csrf_meta_tags %>

<nav>
  <ul>
    <% if user_signed_in? %>
      <li><%= link_to "Meus Posts", posts_path %></li>
      <li>
        <%= button_to 'Logout', logout_path, method: :delete, class: 'btn btn-danger', data: { confirm: 'Are you sure?' } %>
      </li>
    <% else %>
      <li><%= link_to "Login", login_path %></li>
      <li><%= link_to "Cadastrar-se", new_user_path %></li>
    <% end %>
  </ul>
</nav>

<h1><%= @post.title %></h1>

<p><%= @post.content %></p>
<p>Criado por: <%= @post.user.username %></p>
<p>Data de criação: <%= @post.created_at.strftime('%d/%m/%Y %H:%M') %></p>

<% if @post.updated_at != @post.created_at %>
  <p style="color: red;">(editado)</p>
<% end %>

<%= link_to 'Editar', edit_post_path(@post) if user_signed_in? %>
<%= link_to 'Voltar', posts_path %>

<h2>Comentários</h2>

<% @post.comments.each do |comment| %>
  <div>
    <p><strong><%= comment.user&.username || 'Anônimo' %>:</strong> <%= comment.content %></p>
    <% if user_signed_in? && (comment.user == current_user || comment.anonymous) %>
      <%= form_for [@post, comment], method: :delete, remote: true, data: { confirm: 'Tem certeza que deseja remover este comentário?' } do |f| %>
        <%= f.submit 'Remover', class: 'btn btn-danger btn-sm' %>
      <% end %>
    <% end %>
  </div>
<% end %>

<% if user_signed_in? %>
  <h3>Adicionar Comentário</h3>
  <%= form_with model: [@post, @post.comments.build] do |form| %>
    <%= form.text_area :content, placeholder: 'Seu comentário aqui...', class: 'form-control' %>
    <%= form.submit 'Comentar', class: 'btn btn-primary mt-2' %>
    <%= form.hidden_field :anonymous, value: 'true' %>
    <%= form.submit 'Comentar Anônimo', class: 'btn btn-secondary mt-2' %>
  <% end %>
<% else %>
  <p>Por favor, faça login para comentar.</p>
<% end %>

</body>
</html>
